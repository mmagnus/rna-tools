{% extends "base.html" %}
{% block content %}
<title>rna-tools.online</title>

<style>
 .hint {color:#808080;font-size:12px;}

.dz {
    border: dashed !important;
    background-color: white !important;
    border-radius: 10px !important;
}

.dz:hover {
    background-color: aliceblue !important;
}
</style>

<script>

    var progress_interval;

    $(document).ready( function(){
        progress_interval = setInterval(checkProgress, 1000);
    });

    function checkProgress() {
        $.ajax({
            url: "{% url 'ajax_job_status' job_id=j.job_id %}",
            success: function(d) {
                $("#log_txt").html(d['log']);
                if (d['reload']==true){
                    window.location.reload()
                }
            }
    })
    };

  function rm(){
        $.ajax({
            url: "/run/clear/{{ j.job_id }}",
	})
    };

   function demo(){
        $.ajax({
            url: "/demo/{{ tool }}/{{ j.job_id }}",
	})
    };

    function go() {
        $.ajax({
            url: "/run/diffpdb/{{ j.job_id }}",
            success: function(d) {
                $("#log_txt").html(d['log']);
                if (d['reload']==true){
                    window.location.reload()
                }
            }
        })
    };

</script>


<h2>diffpdb</h2>

<div align="right">
  <button onclick="demo()" class="btn btn-small btn-ok">Load demo</button>
  <button onclick="rm()" class="btn btn-small btn-ok">Reset</button>
</div>

<label for="comment">Upload two structures you want to compare (in the PDB format)</label>

<form enctype='multipart/form-data' action="/upload/{{ j.job_id }}" method='POST' class="dropzone dz" id="my-dropzone" >
  {% csrf_token %}
  <input type="hidden" id="job_id" name="job_id" value="{{ j.job_id }}" />
    <div class="fallback">
      <input name="file" type="file" multiple />
    </div>
</form>

    <pre><div id="log_txt" class='log'>{{ log | safe }}</div></pre>
    
<p>The raw output files for each step of the pipeline can be found <a href="{% url 'download_project_dir' job_id=j.job_id %}">here</a></p>

<p>
  <button onclick="go()" class="btn btn-large btn-success">Run!</button>
</p>

    <small class="hint">

  <p>
    <h5>Documentation</h5>
  </p>
<p>
  The tool uses 'diff' comment for text-based comparison of files. Read more on 'diff' <a href="https://en.wikipedia.org/wiki/Diff#Usage">here</a>
</p>
      <p>
	diffpdb checks the consistency between annotations of two structural files. The tool ignores 3D coordinates of atoms and compares only text-content of two files in the PDB to identify the difference in the annotation of atoms, missing atoms (missing the O2â€² atom) and missing fragment (shown on the left side with the gray-red bar).
      </p>

      <pre>
ATOM      8  C2'   G A  57					ATOM      8  C2'   G A  57
# this is when these two files differe, this is the place when O2' atom exists on the left 
# (crystal structure) and not on the right (SimRNA model)
ATOM      9  C1'   G A  57				      |	ATOM      9  O2'   G A  57
ATOM     10  N1    G A  57				      |	ATOM     10  C1'   G A  57
    </pre>
<p>
  diffpdb can be also used locally with a diff viewer of choince. Here the detection of missing O2' atom in one of the structure can be easily detected. This is
</p>
<p>
  Read more on this puzzle here <a href="https://github.com/mmagnus/RNA-Puzzles-Standardized-Submissions/tree/master/rp17">https://github.com/mmagnus/RNA-Puzzles-Standardized-Submissions/tree/master/rp17</a>
</p>
Slightly different presentation of the same information can be viewed with other diff viewers, like DiffMerge here:
 	<center>
          <img src="{{ STATIC_URL }}app/img/diffpdb.jpg" width="60%"  alt="">
	</center>
	
</p>
More at <a href="https://rna-tools.readthedocs.io/en/latest/tools.html?highlight=diffpdb#module-rna_tools.tools.diffpdb.diffpdb">https://rna-tools.readthedocs.io/en/latest/tools.html?highlight=diffpdb#module-rna_tools.tools.diffpdb.diffpdb</a>
    </small>
    
{% endblock %}
